<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menu Inicial</title>
  <style>
    /* Estilos básicos para o corpo */
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(to bottom, #2c3e50, #4ca1af);
      margin: 0;
      font-family: sans-serif;
      color: #ffffff; /* Cor padrão do texto */
      overflow: hidden; /* Prevenir scrollbars indesejadas */
    }

    /* Estilos para os botões no hover (Menu Principal) */
    .menu-container .menu-buttons button:hover {
        background-color: rgba(255, 255, 255, 0.2) !important;
        border-color: rgba(255, 255, 255, 0.8) !important;
    }

    /* --- ESTILOS COPIADOS E ADAPTADOS DE optionsMenu.html --- */

    #optionsMenu {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        z-index: 1001;
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        font-family: sans-serif;
        overflow: hidden;
    }

    #optionsMenu #backToMainBtn:hover {
         background-color: rgba(150, 150, 150, 0.3) !important;
         border-color: rgba(255, 255, 255, 0.8) !important;
    }

    #optionsMenu .keybind-button {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.4);
        color: #ffffff;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.9em;
        text-align: center;
        min-width: 60px;
        width: 100%;
        box-sizing: border-box;
        cursor: pointer;
        transition: background-color 0.2s ease, border-color 0.2s ease;
    }

    #optionsMenu .keybind-button:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.6);
    }

    #optionsMenu .keybind-button.waiting {
        background: rgba(255, 200, 0, 0.3);
        border-color: rgba(255, 200, 0, 0.7);
        color: #ffcc00;
    }

    #optionsMenu .fixed-keybind-display {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.4);
        color: #ffffff;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.9em;
        text-align: center;
        min-width: 60px;
        cursor: default;
        width: 100%;
        box-sizing: border-box;
    }

    #optionsMenu fieldset {
         margin-bottom: 10px;
         border: 1px solid rgba(255, 255, 255, 0.2);
         border-radius: 8px;
         padding: 15px 25px;
         width: 100%;
         box-sizing: border-box;
    }

    #optionsMenu legend {
         padding: 0 10px;
         color: #ccc;
         font-size: 0.8em;
         font-weight: bold;
         text-transform: uppercase;
         letter-spacing: 0.5px;
    }

    #optionsMenu label {
         justify-self: end;
         font-size: 0.95em;
    }

    #optionsMenu .options-grid {
        width: 100%;
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 10px 15px;
        align-items: center;
        font-size: 0.95em;
    }

    #optionsMenu #keybindMessage {
        text-align: center;
        margin-top: 10px;
        font-size: 0.85em;
        color: #ffcc00;
        min-height: 1.2em;
    }
  </style>
</head>
<body>
  <!-- Menu Principal Container -->
  <div class="menu-container" style="
    background: rgba(30, 30, 30, 0.85);
    padding: 40px 60px;
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    gap: 30px;
    align-items: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
    color: #ffffff;
  ">
    <h1 style="
        margin: 0 0 10px 0;
        font-size: 2.5em;
        font-weight: 300;
        letter-spacing: 1px;
        color: #ffffff;
    ">Bouncy Ball</h1>

    <div class="menu-buttons" style="
        display: flex;
        flex-direction: column;
        gap: 20px;
        align-items: center;
    ">
      <button id="playButton" style="
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: #ffffff;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            width: 220px;
            text-align: center;
      ">Jogar</button>

      <button id="optionsButton" style="
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: #ffffff;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            width: 220px;
            text-align: center;
      ">Opções</button>

      <button id="creditsButton" style="
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: #ffffff;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            width: 220px;
            text-align: center;
      ">Créditos</button>
    </div>
  </div>

  <!-- Menu de Opções Container -->
  <div id="optionsMenu">
    <div style="
        background: rgba(30, 30, 30, 0.85);
        padding: 30px 50px;
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        align-items: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        color: #ffffff;
        min-width: 400px;
        max-height: 90vh;
        overflow-y: auto;
    ">
        <h2 style="
            color: #ffffff;
            margin: 0 0 15px 0;
            font-size: 2em;
            font-weight: 300;
            letter-spacing: 1px;
        ">Controles</h2>

        <!-- Keybindings Section -->
        <fieldset>
            <legend>Atalhos de Teclado (Movimento)</legend>
            <div class="options-grid">
                <label for="keybindForward">Frente:</label>
                <button class="keybind-button" id="keybindForward" data-action="forward">W</button>

                <label for="keybindBackward">Trás:</label>
                <button class="keybind-button" id="keybindBackward" data-action="backward">S</button>

                <label for="keybindLeft">Esquerda:</label>
                <button class="keybind-button" id="keybindLeft" data-action="left">A</button>

                <label for="keybindRight">Direita:</label>
                <button class="keybind-button" id="keybindRight" data-action="right">D</button>

                <label for="keybindJump">Saltar:</label>
                <button class="keybind-button" id="keybindJump" data-action="jump">Space</button>
            </div>
            <p id="keybindMessage"></p>
        </fieldset>

        <!-- Development Controls Section -->
        <fieldset>
            <legend>Controles de Desenvolvimento</legend>
            <div class="options-grid">
                <label>UI:</label>
                <button class="fixed-keybind-display">1</button>

                <label>Noclip:</label>
                <button class="fixed-keybind-display">2</button>

                <label>Checkpoints:</label>
                <button class="fixed-keybind-display">3</button>
            </div>
        </fieldset>

        <button id="backToMainBtn" style="
            background: rgba(100, 100, 100, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: #ffffff;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            width: 200px;
            text-align: center;
            margin-top: 15px;
        ">Voltar ao Menu</button>
    </div>
  </div>

  <script type="module">
    import { bindMenuSounds } from './utils/menuSoundSetup.js';
    import { playMenuClickSound } from './utils/audioUtils.js';

    const mainMenuContainer = document.querySelector('.menu-container');
    const optionsMenuContainer = document.getElementById('optionsMenu');
    const playBtn = document.getElementById('playButton');
    const optionsBtn = document.getElementById('optionsButton');
    const creditsBtn = document.getElementById('creditsButton');
    const backToMainBtn = document.getElementById('backToMainBtn');
    const keybindButtons = optionsMenuContainer.querySelectorAll('.keybind-button');
    const keybindMessage = optionsMenuContainer.querySelector('#keybindMessage');

    let settings = {
        keybinds: {
            forward: 'W',
            backward: 'S',
            left: 'A',
            right: 'D',
            jump: 'Space'
        }
    };

    function showMainMenu() {
        mainMenuContainer.style.display = 'flex';
        optionsMenuContainer.style.display = 'none';
    }

    function showOptionsMenu() {
        mainMenuContainer.style.display = 'none';
        optionsMenuContainer.style.display = 'flex';
        keybindMessage.textContent = '';
    }

    bindMenuSounds();

    if (playBtn) {
      playBtn.addEventListener('click', () => {
        playMenuClickSound();
        setTimeout(() => {
          window.location.href = 'levels.html';
        }, 150);
      });
    }

    if (optionsBtn) {
      optionsBtn.addEventListener('click', () => {
        playMenuClickSound();
        showOptionsMenu();
      });
    }

    if (creditsBtn) {
        creditsBtn.addEventListener('click', () => {
            playMenuClickSound();
            alert('Créditos ainda não implementados.');
        });
    }

    if (backToMainBtn) {
        backToMainBtn.addEventListener('click', () => {
            playMenuClickSound();
            showMainMenu();
        });
    }

    let listeningButton = null;

    function updateDisplay() {
        keybindButtons.forEach(button => {
            const action = button.dataset.action;
            if (action && settings.keybinds[action]) {
                const key = settings.keybinds[action];
                button.textContent = key === ' ' ? 'Space' : key.toUpperCase();
            }
        });
    }

    function handleKeydown(event) {
        event.preventDefault();
        event.stopPropagation();
        if (!listeningButton) return;

        let newKey = event.key;
        const action = listeningButton.dataset.action;

        if (newKey === 'Escape') {
            keybindMessage.textContent = 'Atribuição cancelada.';
            listeningButton.classList.remove('waiting');
            listeningButton.disabled = false;
            listeningButton = null;
            document.removeEventListener('keydown', handleKeydown, true);
            keybindButtons.forEach(btn => btn.disabled = false);
            updateDisplay();
            return;
        }

        if (newKey === ' ') {
            newKey = 'Space';
        }

        if (newKey && newKey.length === 1 || ['Space', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(newKey)) {
             let conflict = false;
             let conflictAction = null;
             for (const act in settings.keybinds) {
                 if (settings.keybinds[act].toUpperCase() === newKey.toUpperCase() && act !== action) {
                     conflict = true;
                     conflictAction = act;
                     break;
                 }
             }

             if (conflict) {
                  keybindMessage.textContent = `Tecla '${newKey.toUpperCase()}' já está em uso por '${conflictAction}'!`;
             } else {
                 settings.keybinds[action] = newKey;
                 keybindMessage.textContent = '';
                 updateDisplay();
                 console.log("Keybinds updated:", settings.keybinds);

                 listeningButton.classList.remove('waiting');
                 listeningButton.disabled = false;
                 listeningButton = null;
                 document.removeEventListener('keydown', handleKeydown, true);
                 keybindButtons.forEach(btn => btn.disabled = false);
             }
        } else {
             keybindMessage.textContent = `Tecla '${newKey}' inválida.`;
        }
    }

    keybindButtons.forEach(button => {
        button.addEventListener('click', () => {
            playMenuClickSound();
            if (listeningButton) {
                listeningButton.classList.remove('waiting');
                listeningButton.disabled = false;
                updateDisplay();
            }

            listeningButton = button;
            button.textContent = 'Pressione...';
            button.classList.add('waiting');
            keybindMessage.textContent = 'Pressione uma tecla... (ESC para cancelar)';

            keybindButtons.forEach(btn => {
                if (btn !== listeningButton) btn.disabled = true;
            });
            button.disabled = false;

            setTimeout(() => {
                document.addEventListener('keydown', handleKeydown, true);
            }, 50);
        });
    });

    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
            if (listeningButton) {
                return;
            }
            if (optionsMenuContainer.style.display === 'flex') {
                event.preventDefault();
                playMenuClickSound();
                showMainMenu();
            }
        }
    }, false);

    updateDisplay();
    showMainMenu();
  </script>
</body>
</html>